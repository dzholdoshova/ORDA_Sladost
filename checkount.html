<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORDA - –ó–∞–∫–∞–∑</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="logo"><i class="fas fa-candy-cane"></i> ORDA</div>
        <nav>
            <ul>
                <li><a href="glavnystr.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="index.html#products">–°–ª–∞–¥–æ—Å—Ç–∏</a></li>
                <li><a href="index.html#about">–û –Ω–∞—Å</a></li>
                <li><a href="index.html#location">–ì–¥–µ –Ω–∞—Å –Ω–∞–π—Ç–∏</a></li>
            </ul>
        </nav>
    </header>

    <p id="order-success" style="color:green; display:none;">
        –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã —Å –≤–∞–º–∏ —Å–≤—è–∂–µ–º—Å—è.
    </p>

    <section class="section">
        <h2 class="section-title">–í–∞—à –∑–∞–∫–∞–∑</h2>
        <div id="checkout-container">
            <ul id="checkout-list">
                <li class="empty-cart-message">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</li>
            </ul>
            <div class="cart-summary">
                <p>–û–±—â–∞—è —Å—É–º–º–∞: <span id="checkout-total">0</span> ‚Ç∏</p>
            </div>
            <form id="checkout-form">
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                <label for="name">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="nameInput" required>

                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="tel" id="phoneInput" required>

                <label for="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" id="addressInput" required>

                <button type="submit" id="send_btn" class="btn checkout-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </form>
        </div>
    </section>

    <div id="cart-container" class="hidden">
        <h3>–í–∞—à –∑–∞–∫–∞–∑</h3>
        <ul id="cart-list">
            <li class="empty-cart-message">–ö–æ—Ä–∑–∏–Ω–∞ –±–æ—à</li>
        </ul>
        <div class="cart-summary">
            <p>–ñ–∞–ª–ø—ã —Å—É–º–º–∞: <span id="cart-total">0</span> ‚Ç∏</p>
        </div>

        <button id="clear-cart-btn" class="btn clear-btn">–ö–∞—Ä–∑–∏–Ω–∞–Ω—ã —Ç–∞–∑–∞–ª–æ–æ</button>
        <a href="checkount.html"><button id="checkout-btn" class="btn checkout-btn" disabled>–ó–∞–∫–∞–∑ –±–µ—Ä“Ø“Ø</button></a>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>ORDA</h3>
                <p>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–∞–¥–æ—Å—Ç–∏ –º–∏—Ä–∞ –≤ —Å–µ—Ä–¥—Ü–µ –ê–ª–º–∞—Ç—ã</p>
            </div>
            <div class="copyright">¬© 2025 ORDA ‚Ä¢ –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</div>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // =================== BOT ===================
            let TOKEN = "8516555949:AAE4BWvvzLppaOPy68eQEXVOqhqEuWIRa0I";
            let CHAT_ID = "5195728202";
            let URL_API = `https://api.telegram.org/bot${TOKEN}/sendMessage`;

            const form = document.getElementById("checkout-form");
            const successMsg = document.getElementById("order-success");
            const sendbtn = document.getElementById("send_btn");

            let sending = false;

            // –ò—à—Ç–µ—Ç“Ø“Ø
            sendbtn.onclick = (e) => {
                e.preventDefault();
                sendTelegram();
            };

            function sendTelegram() {
                if (sending) return;
                sending = true;

                const nameInput = document.getElementById("nameInput").value.trim();
                const phoneInput = document.getElementById("phoneInput").value.trim();
                const addressInput = document.getElementById("addressInput").value.trim();
                const total = document.getElementById("checkout-total").innerText;

                if (!nameInput || !phoneInput || !addressInput) {
                    alert("–ë–∞—Ä–¥—ã–∫ —Ç–∞–ª–∞–∞–ª–∞—Ä–¥—ã —Ç–æ–ª—Ç—É—Ä—É“£—É–∑!");
                    sending = false;
                    return;
                }

                let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
                let cartText = cartItems.map(item => `‚Ä¢ ${item.name} x ${item.quantity} = ${item.price * item.quantity} ‚Ç∏`).join('\n');

                let payload = `
üõí –ñ–ê“¢–´ –ó–ê–ö–ê–ó
üë§ –ê—Ç—ã: ${nameInput}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phoneInput}
üè† –î–∞—Ä–µ–∫: ${addressInput}

üì¶ –¢–æ–≤–∞—Ä–ª–∞—Ä:
${cartText}

üí∞ –ñ–∞–ª–ø—ã —Å—É–º–º–∞: ${total} —Å–æ–º
        `;

                fetch(URL_API, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: payload
                    })
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.ok) {
                            successMsg.style.display = "block";
                            localStorage.removeItem('cart');
                            form.reset();
                            form.style.display = 'none';
                            setTimeout(() => location.reload(), 2000);
                        } else {
                            alert("–ö–∞—Ç–∞ –∫–µ—Ç—Ç–∏: " + JSON.stringify(data));
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert("–ö–∞—Ç–∞ –∫–µ—Ç—Ç–∏, –∫–∞–π—Ä–∞ –∞—Ä–∞–∫–µ—Ç –∫—ã–ª—ã“£—ã–∑");
                    })
                    .finally(() => sending = false);
            }

            // =================== CHECKOUT ===================
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const checkoutList = document.getElementById('checkout-list');
            const checkoutTotal = document.getElementById('checkout-total');
            const submitButton = form.querySelector('button[type="submit"]');

            function updateCheckout() {
                checkoutList.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    checkoutList.innerHTML = '<li class="empty-cart-message">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞</li>';
                    checkoutTotal.textContent = '0';
                    submitButton.disabled = true;
                    return;
                }

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const li = document.createElement('li');
                    li.className = 'checkout-item';
                    li.innerHTML = `
                <span class="item-details">${item.name} x ${item.quantity} - ${itemTotal} ‚Ç∏</span>
                <button class="remove-item-btn" data-product-id="${item.id}"><i class="fas fa-times"></i></button>
            `;
                    checkoutList.appendChild(li);
                });

                checkoutTotal.textContent = total.toLocaleString('ru-RU');
                submitButton.disabled = false;

                document.querySelectorAll('.remove-item-btn').forEach(button => {
                    button.addEventListener('click', removeItem);
                });
            }

            function removeItem(e) {
                e.preventDefault();
                const productId = e.currentTarget.dataset.productId;
                cart = cart.filter(item => item.id !== productId);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCheckout();
            }

            updateCheckout();

        });
    </script>

</body>

</html>